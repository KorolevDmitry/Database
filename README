Database application
Dmitry Korolev, Computer Science Center, 2013

Database designed to use simple key-value (string-string for now) storage.

Solution consists of 3 main parts: Base, Client and Server.

=====BASE=====
Module that consists of common parts for others (exceptions, entities and some components).
There are next components: Lexer, Parser, Evaluator, Balancer, TransactionLogger, TcpListener, TcpSender.
-----Lexer-----
Base implementation for splitting commands on lexemes.
-----Parser-----
Abstract class that implements some common methods for client and server parsers.
-----Evaluator-----
Abstract class that implements some common methods for client, server and balancer evaluators.
-----Balancer-----
Component is responsible for routing commands between servers.
For now it resides on client side. Then will be extracted to separate module.
There are 2 implementations: StaticBalancer (use now) and DynamicBalancer.
StaticBalancer routes commands based on hash code of key.
DynamicBalancer features:
1) pings servers to check its availability;
2) can add/remove servers and request data replication if needed;
3) use ConsistentHash to reduce replication data;
4) can accept and execute commands from command line.
For now: not added to release. Do not consider any fail scenarios (the only: node can be switched off for a while and then switched on,
but without any additional replication). In testing...
-----TransactionLogger-----
Storage based on DataStorage that stores queries in key/value manner where key is unique id of query.
For now: not added to release.
-----TcpListener-----
Component to listen tcp channel execute commands by given Evaluator and send EvaluationResult back.
Use additional thread.
-----TcpSender-----
Send requests by tcp channel listen response. Parse it to EvaluationResult and gives back.

=====SERVER=====
Console application that listen port and communicate with client by tcp channel via TcpListener.
There are next components: ServerParser, DataStorage, ServerEvaluator.
For now: will be added one nore component: ServerEngine, that will accumulate all components.
-----ServerParser-----
Concrete implementation of Parser that interprets string requests to server commands.
-----DataStorage-----
KeyValue storage with get, add, addOrUpdate, delete methods.
There are 2 implementations:
1) MemoryBasedDataStorage - store data in memory in ConcurrentHashMap;
2) FileBasedDataStorage - store data in files with given split rate (by hash of key).
                          Has index by key with position of value in file. Use ConcurrentHashMap and flush it to file.
                          Store data with ObjectOutputStream.
3) CombinedDataStorage - use both previous storages.
                          When memory limit is overflown it redirect half of data in MemoryBasedDataStorage to
                          FileBasedDataStorage synchronously.
-----ServerEvaluator-----
Analyse requested command and execute it by redirect request to given DataStorage.
For now: consider opportunity to reduce switches and move logic of executions to commands.
---===USAGE===---
You can use program with next arguments:
        --help - Print description of acceptable arguments
        --port {port} - Port number to listen requests.
        --mode {mode} - Opportunity to run server in different modes:
                Memory - to store values only in memory.
                File - to store values only in file storage.
                Combined - to store values only in combined storage mode.
        --directory {directory} - Directory for storing files of database. Applied only for Memory and Combined modes.
        --split-rate {split-rate} - Count of files to store database in. Applied only for Memory and Combined modes.
        --memory-max-size {memory-max-size} - Size of database in bytes that will be cached in memory. Applied only for Combined mode.
        --generate-elements-count {generate-elements-count} - Count of sample items to generate (key is integer from 0 till count-1).
        --generate-value_size {generate-value_size} - Size of values in bytes to generate.
--EXAMPLE
--port 1107 --mode memory

=====CLIENT=====
Console application that send requests to servers (choose server by Balancer) via TcpSender.
There are next components: ClientParser, ClientEvaluator.
-----ClientParser-----
Concrete implementation of Parser that interprets string requests to client commands.
-----ClientEvaluator-----
Execute client requests.
Use Balancer to get route where to send command.
Use TcpSender to send request.
Use Parser to parse request.
---===USAGE===---
You can use program with next arguments:
        --list-of-servers {hostname:port[;hostname:port]*} - List of servers to connect to.
There are number of commands:
        get {key} - Get value from storage.
        add {key} {value} - Add value to storage.
        update {key} {value} - Update value from storage.
        add_or_update {key} {value} - Add value to storage if it is not exists and update it in another case.
        delete {key} - Delete value from storage.
        help - Print list of accessible commands.
        quit - Quit.
